---
plan_id: 04-01
phase: 04-rich-components
wave: 1
autonomous: true
gap_closure: false
checkpoints: []
files_modified: []
estimated_tasks: 8
---

# Plan: 04-Rich Components

## Objective
Afegir components visuals avançats: images, code syntax highlight, rich text editor, i JSON viewer.

## Context
- Fase 03 completada (actions i polling funcionant)
- Canvas Figma-like ja té estructura per components
- Backend ja suporta JSON flexible

## Tasks

### Task 1: Setup Dependencies
**Description:** Instal·lar llibreries necessàries.

**Commands:**
```bash
cd ~/projects/dockerclaw/dockerclaw-web
npm install @tiptap/react @tiptap/starter-kit @tiptap/extension-link
npm install prismjs @types/prismjs react-simple-code-editor
npm install react-json-view-lite
npm install @supabase/supabase-js
```

**Acceptance Criteria:**
- [ ] Dependencies instal·lades sense errors
- [ ] Build passa

### Task 2: Image Component
**Description:** Component per pujar i mostrar imatges.

**Files:**
- `src/components/card/ImageComponent.tsx`
- `src/app/api/upload/route.ts` (upload endpoint)

**Features:**
- Drag-drop upload
- Preview thumbnail
- Click per lightbox
- Storage a Supabase

**Acceptance Criteria:**
- [ ] Pujar imatge funciona
- [ ] Preview es mostra
- [ ] Lightbox obra imatge gran

### Task 3: Code Component with Syntax Highlight
**Description:** Millorar component code amb syntax highlight.

**Files:**
- `src/components/card/CodeComponent.tsx` (refactor)

**Features:**
- PrismJS syntax highlight
- Language selector (auto-detect o manual)
- Copy to clipboard button
- Line numbers

**Acceptance Criteria:**
- [ ] Syntax highlight funciona
- [ ] Copy button funciona
- [ ] Suporta múltiples llenguatges

### Task 4: Rich Text Editor (TipTap)
**Description:** Component text amb editor WYSIWYG.

**Files:**
- `src/components/card/RichTextComponent.tsx`
- `src/components/TiptapToolbar.tsx`

**Features:**
- Toolbar: bold, italic, h1, h2, bullet list, ordered list, link
- Markdown suport
- Edició in-place (com Fase 03)
- Bubble menu (toolbar contextual)

**Acceptance Criteria:**
- [ ] Editor TipTap funciona
- [ ] Toolbar mostra/escondeix correctament
- [ ] Formatting s'aplica
- [ ] Guarda a backend

### Task 5: JSON/Data Viewer
**Description:** Component per mostrar JSON estructurat.

**Files:**
- `src/components/card/DataComponent.tsx`

**Features:**
- Tree view col·lapsible
- Syntax highlight
- Copy JSON button
- Search (opcional)

**Acceptance Criteria:**
- [ ] JSON es renderitza com arbre
- [ ] Nodes col·lapsables
- [ ] Copy button funciona

### Task 6: Update Card Renderer
**Description:** Actualitzar Card component per suportar nous tipus.

**Files:**
- `src/components/Card.tsx`
- `src/components/card/index.ts`

**Changes:**
- Afegir cases per 'image', 'rich_text', 'data'
- Render condicional segons component type

**Acceptance Criteria:**
- [ ] Tots els components es renderitzen
- [ ] No hi ha regressions

### Task 7: Integració amb Actions
**Description:** Assegurar que els nous components funcionen amb actions.

**Verificar:**
- Rich text: edit_text funciona
- Image: upload + delete funciona
- Data: view only (per ara)

**Acceptance Criteria:**
- [ ] Accions funcionen amb nous components
- [ ] Polling rep updates correctament

### Task 8: Testing & Polish
**Description:** Testing i UI polish.

**Tasks:**
- [ ] Test cada component amb dades reals
- [ ] Verificar responsive (mínim)
- [ ] UI polish: ombres, transitions, hover states
- [ ] Update nestor-memory.md
- [ ] Commit + push

## Definition of Done
- [ ] Image component funciona (upload, preview, lightbox)
- [ ] Code component té syntax highlight
- [ ] Rich text editor funciona (TipTap)
- [ ] JSON viewer funciona
- [ ] Tots integrats amb Card renderer
- [ ] Actions funcionen amb nous components
- [ ] Git commit + push
