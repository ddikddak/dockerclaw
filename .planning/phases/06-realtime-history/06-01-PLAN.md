# Phase 06: Real-time & History - Plan 06-01

## Tasks

### Task 1: Create Database Tables
**Files:** SQL migration
**Description:** Create activity_log and notifications tables in Supabase
- activity_log: id, action, actor_type, actor_id, actor_name, target_type, target_id, metadata, created_at
- notifications: id, user_id, activity_id, read, created_at
- Indexes for performance

### Task 2: Create SSE Endpoint
**Files:** `frontend/src/app/api/stream/route.ts`
**Description:** Server-Sent Events endpoint for real-time updates
- GET /api/stream with proper SSE headers
- Channel-based broadcasting (card:*, user:*)
- Keep-alive mechanism
- Client connection management

### Task 3: Create Activity Log Service
**Files:** `frontend/src/lib/activity.ts`
**Description:** Utility to log all actions to activity_log table
- logActivity() function
- Actions: card_created, card_updated, card_deleted, comment_added, reaction_added, action_executed
- Automatic broadcast to SSE clients

### Task 4: Integrate Activity Logging
**Files:** Modify existing API routes
**Description:** Add activity logging to all mutations
- Card creation, updates, status changes
- Comments add/delete
- Reactions toggle
- Actions execution

### Task 5: Create Activity Timeline Component
**Files:** `frontend/src/components/ActivityTimeline.tsx`
**Description:** UI component to display activity history
- Timeline with icons per action type
- Actor info with avatar/badge
- Timestamp with relative time
- Filter by action type

### Task 6: Create Notifications System
**Files:** `frontend/src/components/Notifications.tsx`, `frontend/src/app/api/notifications/route.ts`
**Description:** In-app notifications with badge count
- Notification bell icon with unread badge
- Dropdown with recent notifications
- Mark as read functionality
- Real-time notification via SSE

### Task 7: Create SSE Provider and Integration
**Files:** `frontend/src/components/SSEProvider.tsx`, `frontend/src/hooks/useSSE.ts`
**Description:** React context and hooks for SSE
- SSE connection management
- Auto-reconnect with exponential backoff
- Event handlers for different message types
- Integration with Board/Card components for live updates

## Success Criteria
- [ ] SSE connection stable with auto-reconnect
- [ ] Activity log captures all card mutations
- [ ] Notifications appear in real-time
- [ ] Unread badge updates automatically
- [ ] Activity timeline shows filtered history
